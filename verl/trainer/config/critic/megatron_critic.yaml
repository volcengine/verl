# defaults specify the default config from each component
defaults:

  # megatron optimizer config
  - ../optim@optim: megatron

  # megatron engine config
  - ../engine@megatron: megatron

  # dp actor config, inheriting from trainer/config/critic/critic.yaml
  - critic

  # load the reference default config, then apply the fields in the current yaml
  - _self_

# Required when using verl.utils.omega_conf_to_dataclass to instantiate dataclass configs
_target_: verl.workers.config.McoreCriticConfig

strategy: megatron

# seconds, default is 10 minutes for torch, you can set it to a larger value if you have long-running operations like 32B or 72B model using megatron
nccl_timeout: 600

# model config for the critic
model:

  # Required when using verl.utils.omega_conf_to_dataclass to instantiate dataclass configs
  _target_: verl.trainer.config.BaseModelConfig

  # override default empty mapping
  override_config:

    model_config: {}

    moe_config:

      freeze_moe_router: False

  # LoRA (Low-Rank Adaptation) configuration for parameter-efficient fine-tuning
  lora:
    # LoRA rank (dimension of adaptation matrices). Set to 0 to disable LoRA
    rank: 0  # typical values: 8, 16, 32, 64
    
    # LoRA alpha (scaling parameter, typically 2x rank)
    alpha: 16
    
    # LoRA dropout rate
    dropout: 0.0
    
    # LoRA type: "lora", "canonical_lora", or "dora"
    type: lora
    
    # Target modules to apply LoRA to under megatron context
    # For fused LoRA (default): ["linear_qkv", "linear_proj", "linear_fc1", "linear_fc2"]
    # For canonical LoRA: ["linear_q", "linear_k", "linear_v", "linear_proj", "linear_fc1_up", "linear_fc1_gate", "linear_fc2"]
    target_modules:
      - linear_qkv
      - linear_proj
      - linear_fc1
      - linear_fc2
    
    # Exclude modules from apply LoRA to under megatron context
    exclude_modules: []

    # Path to pre-trained LoRA adapter weights (null to train from scratch)
    adapter_path: null

# Whether to load initial weights
load_weight: True

# seed for data loader
data_loader_seed: ${oc.select:actor_rollout_ref.actor.data_loader_seed,null}
